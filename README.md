# Rainfall2MOHID: Hourly Rainfall Data to MOHID FillMatrix Converter

## Overview

This Python executable, **Rainfall2MOHID**, converts hourly rainfall data from various rain gauge stations into SRM format files compatible with MOHID-Land's FillMatrix tool. These SRM files facilitate spatial and temporal variation of rainfall data, essential for hydrological modeling.

The program requires input from two CSV files:
- **coordinates.csv**: Contains station names, latitude, and longitude.
- **hourly_rainfall.csv**: Provides hourly rainfall data for each station.

The converted output consists of:
- SRM format files (*.srm): One file per station, containing hourly precipitation data.
- **FillMatrix.dat**: Configuration file for MOHID-Land's FillMatrix tool, specifying precipitation properties and output settings.
- **output.hdf5**: HDF5 format output file generated by FillMatrix.

## Features

- **Input Validation**: Ensures presence and correct format of required files (`FillMatrix.exe`, `topography.dat`, `coordinates.csv`, `hourly_rainfall.csv`).
- **Data Validation**: Verifies correctness of coordinate data, date formats, and numeric values in rainfall data.
- **File Generation**: Creates SRM files for each station based on input data.
- **Configuration File Creation**: Generates a FillMatrix configuration file (`FillMatrix.dat`) to specify input data, output settings, and interpolation methods.
- **Execution of FillMatrix**: Automatically runs the FillMatrix tool to process the generated configuration and produce an HDF5 output file.

## Usage

1. **Setup**: Ensure `FillMatrix.exe` and `topography.dat` are placed in the same directory as the executable. Download the executable from the [MOHID GitHub repository](https://github.com/Mohid-Water-Modelling-System/Mohid/tree/master/Software/FillMatrix). A functional version will also be provided in a zip file on the Rainfall2MOHID repository.
2. **Input Files**: Prepare `coordinates.csv` and `hourly_rainfall.csv` with required data. Example files will be available in the Rainfall2MOHID repository.
3. **Execution**: Run the executable, which validates input files, generates SRM files, creates the FillMatrix configuration file, executes `FillMatrix.exe`, and produces `output.hdf5`.

## Error Handling

**Error Codes and Solutions:**

1. **Error 1**: `FillMatrix.exe` not found.
   - **Solution**: Download `FillMatrix.exe` from the [MOHID GitHub repository](https://github.com/Mohid-Water-Modelling-System/Mohid/tree/master/Software/FillMatrix) and place it in the executable's directory. Alternatively, use the provided zip file containing a functional version on the Rainfall2MOHID repository.

2. **Error 2**: Required file (`coordinates.csv` or `hourly_rainfall.csv`) not found.
   - **Solution**: Ensure both input files are in the executable's directory. Example files will be available in the Rainfall2MOHID repository.

3. **Error 3**: `topography.dat` not found.
   - **Solution**: This file is generated during the construction of the MOHID-Land model and defines the user's working domain. Ensure `topography.dat` corresponds to the user's domain, and place it in the executable's directory.

4. **Error 4**: Incorrect header format in `coordinates.csv`.
   - **Solution**: Verify that the header includes "COORD_Y" and "COORD_X".

5. **Error 5**: Empty cells found in coordinate columns of `coordinates.csv`.
   - **Solution**: Ensure all coordinate fields are filled.

6. **Error 6**: Non-numeric values found in coordinate columns of `coordinates.csv`.
   - **Solution**: Correct the non-numeric entries in latitude and longitude.

7. **Error 7**: Incorrect date format in `hourly_rainfall.csv`.
   - **Solution**: Check and correct the date format in the input file to "dd/mm/yyyy hh:min".

8. **Error 8**: Empty cells found in rainfall data columns of `hourly_rainfall.csv`.
   - **Solution**: Ensure all rainfall data fields are filled.

9. **Error 9**: Negative values found in rainfall data columns of `hourly_rainfall.csv`.
   - **Solution**: Replace negative values with valid positive measurements.

10. **Error 10**: Non-numeric values found in rainfall data columns of `hourly_rainfall.csv`.
    - **Solution**: Correct non-numeric entries in rainfall data to numeric values.

11. **Error 11**: Mismatch in the number of stations in `coordinates.csv` and columns in `hourly_rainfall.csv`.
    - **Solution**: Ensure the number of stations matches the number of columns (excluding the date column) in `hourly_rainfall.csv`.

12. **Error 12**: Failure to convert date format in `hourly_rainfall.csv`.
    - **Solution**: Check and correct the date format in the input file to "dd/mm/yyyy hh:min".

13. **Error 13**: `output.hdf5` not created after FillMatrix execution.
    - **Solution**: Check for errors during FillMatrix execution or review FillMatrix's log for details.

## Example Input Files

**coordinates.csv**:

| STATION | COORD_Y  | COORD_X  |
|---------|----------|----------|
| Station1 | -12.3456 | 34.5678  |
| Station2 | -13.4567 | 35.6789  |
| Station3 | -14.5678 | 36.7890  |
| ...     | ...      | ...      |

**hourly_rainfall.csv**:

| DATE_TIME          | Station1 | Station2 | Station3 | ...     |
|--------------------|----------|----------|----------|---------|
| 01/06/2024 00:00   | 10.5     | 12.3     | 15.2     | ...     |
| 01/06/2024 01:00   | 8.2      | 11.7     | 13.6     | ...     |
| 01/06/2024 02:00   | 6.9      | 10.4     | 12.1     | ...     |
| ...                | ...      | ...      | ...      | ...     |

## Dependencies

- Python 3.x
- Libraries: `os`, `sys`, `re`, `datetime`, `time`, `csv`

## Notes

- **topography.dat**: This file is generated during the construction of the MOHID-Land model and defines the user's working domain. Ensure `topography.dat` corresponds to the user's domain, and place it in the executable's directory.

## Author

- **Author**: Dhiego da Silva Sales
- **Contact**: dhiego.sales@outlook.com
- **Affiliation**: Instituto Federal Fluminense

## License

This project is licensed under the MIT License. See the LICENSE file for details.

---

This README provides a comprehensive guide to setting up and using Rainfall2MOHID for converting hourly rainfall data to MOHID FillMatrix-compatible files. For further assistance or issues, please contact the author via the provided email.

